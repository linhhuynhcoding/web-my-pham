syntax = "proto3";

package api;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "validate/validate.proto";
import "data.proto";

option go_package = "github.com/linhhuynhcoding/web-my-pham/server/api";

service Service {
  // Login
  rpc Login(LoginRequest) returns (LoginResponse) {
    option (google.api.http) = {
      post: "/api/login"
      body: "*"
    };
  }
  // Register
  rpc Register(RegisterRequest) returns (RegisterResponse) {
    option (google.api.http) = {
      post: "/api/register"
      body: "*"
    };
  }

  // Load Home Screen
  rpc LoadHomeScreen(LoadHomeScreenRequest) returns (LoadHomeScreenResponse) {
    option (google.api.http) = {
      get: "/api/home"
    };
  }

  // Load Products by Category
  rpc LoadProductsByCategory(LoadProductsByCategoryRequest) returns (LoadProductsByCategoryResponse) {
    option (google.api.http) = {
      // The category_id will be part of the URL path.
      get: "/api/categories/{category_id}/products"
    };
  }

  // Load Product Detail Page
  rpc LoadProductDetailPage(LoadProductDetailPageRequest) returns (LoadProductDetailPageResponse) {
    option (google.api.http) = {
      get: "/api/products/{product_id}"
    };
  }

  // Load Profile Info Page
  rpc LoadProfileInfoPage(LoadProfileInfoPageRequest) returns (LoadProfileInfoPageResponse) {
    option (google.api.http) = {
      get: "/api/profile"
    };
  }

  // Load User Order Page
  rpc LoadUserOrderPage(LoadUserOrderPageRequest) returns (LoadUserOrderPageResponse) {
    option (google.api.http) = {
      get: "/api/orders_history"
    };
  }

  // Load Cart Page
  rpc LoadCartPage(LoadCartPageRequest) returns (LoadCartPageResponse) {
    option (google.api.http) = {
      get: "/api/cart"
    };
  }

  // Add Cart Item
  rpc AddCartItem(AddCartItemRequest) returns (AddCartItemResponse) {
    option (google.api.http) = {
      post: "/api/cart/items"
      body: "*"
    };
  }

  // Update Cart Item
  rpc UpdateCartItem(UpdateCartItemRequest) returns (UpdateCartItemResponse) {
    option (google.api.http) = {
      put: "/api/cart/items/{cart_item_id}"
      body: "*"
    };
  }

  // Delete Cart Item
  rpc DeleteCartItem(DeleteCartItemRequest) returns (DeleteCartItemResponse) {
    option (google.api.http) = {
      delete: "/api/cart/items/{cart_item_id}"
    };
  }

  // Load Checkout Page
  rpc LoadCheckoutPage(LoadCheckoutPageRequest) returns (LoadCheckoutPageResponse) {
    option (google.api.http) = {
      post: "/api/checkout/load"
      body: "*"
    };
  }
}

message LoginRequest {
  string email = 1 [(validate.rules).string.email = true]; 
  string password  = 2  [(validate.rules).string = {min_len: 1}];
}
message LoginResponse {
  string access_token = 1;
  User user = 2;
}

message RegisterRequest{
  string email = 1 [(validate.rules).string.email = true]; 
  string password  = 2  [(validate.rules).string = {min_len: 1}];
  string confirm_password  = 3  [(validate.rules).string = {min_len: 1}];
  string name = 4 [(validate.rules).string = {min_len: 1}];
}

message RegisterResponse{}

message LoadHomeScreenRequest {}

message LoadHomeScreenResponse {
  repeated Product bestseller_products = 1;
  repeated Product top_search_products = 2;
  repeated Category categories = 3;
  repeated Brand brands = 4;
}

message PriceRange {
  double min = 1;
  double max = 2;
}

message ProductFilter {
  PriceRange price_range = 1;
  repeated int32 brand_ids = 2;
}

enum ProductOrderBy {
  BEST_SELLER = 0;
  PRICE_ASC = 1;
  PRICE_DESC = 2;
}

message LoadProductsByCategoryRequest {
  int32 category_id = 1 [(validate.rules).int32.gt = 0];
  ProductFilter filter = 2;
  ProductOrderBy order_by = 3;
  Pagination pagination = 4;
}

message LoadProductsByCategoryResponse {
  repeated Product products = 1;
  Pagination pagination = 2;
  repeated Brand brands = 3;
}

message LoadProductDetailPageRequest {
  int32 product_id = 1 [(validate.rules).int32.gt = 0];
}

message LoadProductDetailPageResponse {
  Product product = 1;
  repeated Product other_same_category_products = 2; // Renamed for clarity
  repeated Product other_same_brand_products = 3;    // Renamed for clarity
}

message LoadProfileInfoPageRequest {
  // No specific request parameters needed for loading the current user's profile.
}

message LoadProfileInfoPageResponse {
  User user = 1;
}

message LoadUserOrderPageRequest {
  Pagination pagination = 1; // Request pagination details for orders
}

message LoadUserOrderPageResponse {
  repeated Order orders = 1;
  Pagination pagination = 2;
}

message LoadCartPageRequest {
  // No specific request parameters needed for loading the current user's cart.
}

message LoadCartPageResponse {
  repeated CartItem items = 1;
  double total_price = 2;
  double check_out_bill = 3;
}

message AddCartItemRequest {
  int32 product_id = 1 [(validate.rules).int32.gt = 0];
  int32 quantity = 2 [(validate.rules).int32.gt = 0];
}

message AddCartItemResponse {
  CartItem item = 1;
}


message UpdateCartItemRequest {
  int32 cart_item_id = 1 [(validate.rules).int32.gt = 0];
  int32 quantity = 2 [(validate.rules).int32.gt = 0];
}

message UpdateCartItemResponse {
  CartItem item = 1;
}

message DeleteCartItemRequest {
  int32 cart_item_id = 1 [(validate.rules).int32.gt = 0];
}

message DeleteCartItemResponse {

}

message LoadCheckoutPageRequest {
  repeated int32 cart_item_ids = 1 [(validate.rules).repeated .min_items = 1];
}

message OrderInfo {
  repeated CartItem items = 1;
  double shipping_fee = 2;
  double total_price = 3;
}

enum PaymentMethodType {
  PAYMENT_METHOD_TYPE_UNSPECIFIED = 0;
  CASH_ON_DELIVERY = 1;
  VNPAY = 2;
}

message PaymentMethod {
  PaymentMethodType type = 1;
  string name = 2;
}

message OrderDetailForm {
  repeated PaymentMethod available_payment_methods = 1;
}

message LoadCheckoutPageResponse {
  OrderInfo order_info = 1;
  OrderDetailForm order_detail_form = 2;
}
